<!DOCTYPE html>
<html>
<head>
    <title>LOCATION
    </title>

    <script src='/socket.io/socket.io.js'></script>
    <script>
        var socket = io.connect('http://localhost:50000');
        socket.on('udp message', function (msg) {
            var coord = msg.split(",");
            latitud = coord[0];
            longitud = coord[1];
            fecha = coord[2];
            console.log(msg);
        });
    </script>

    <style>
         #map {
        height: 100%;
        width: 100%;
        position:absolute;
        top: 0;
        left: 0;
        z-index: 0; /* Set z-index to 0 as it will be on a layer below the contact form */
            }     
   </style>

</head>

<body> 
    <div style="position:absolute; top:110px; left:0px; z-index:5; width:410px; height:400px; background-color:#CDCDCD; opacity:0.9">
        
        <form 
            style="position:absolute; top:80px; left:10px; z-index: 10;"
            name="formulario_fecha" id="formulario_fecha" method="post">

            <input type="button" value="Ubicacion de registros historicos" id="historia" onclick="showForm(), historiavalues() ">
            <input type="button" value="Ubicacion en vivo" id="live" onclick="hideForm(), livevalues()">
        </form>

        <font color=#000000>
            <h1 style= "font-size:1cm;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif; position:absolute; z-index: 10; left:1cm; top: 10px;" ><i>LOCATION</i></h1>
        </font>
        <font color=#000000>
            <h2 style= "font-size:0.5cm;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif; position:absolute; z-index: 10; left:1cm; top: 100px;" ><i>-Latitud:</i></h2>
        </font>
        <font color=#000000>
            <h2 style= "font-size:0.4cm;font-family:'Times New Roman', Times, serif; position:absolute; z-index: 10; left:3cm; top: 97px;" ><p id="lat"></p></h2>
        </font>
        <font color=#000000>
            <h3 style= "font-size:0.5cm;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif; position:absolute; z-index: 10; left:1cm; top: 140px;" ><i>-Longitud:</i></h3>
        </font>
        <font color=#000000>
            <h3 style= "font-size:0.4cm;font-family:'Times New Roman', Times, serif; position:absolute; z-index: 10; left:3.5cm; top: 137px;" ><p id="long"></p></h3>
        </font>
        <font color=#000000>
            <h4 style= "font-size:0.5cm;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif; position:absolute; z-index: 10; left:1cm; top: 180px;" ><i>-Timestamp:</i></h4>
        </font>
        <font color=#000000>
            <h4 style= "font-size:0.4cm;font-family:'Times New Roman', Times, serif; position:absolute; z-index: 10; left:4cm; top: 177px;" ><p id="timestamp"></p></h4>
        </font>



        <form 
            style="display: none; position:absolute; top:250px; left:10px; z-index: 10;" 
            name="form_fecha" id="form_fecha" method="post" autocomplete="off">

            <label for="inicio">Selecciona la fecha y hora del inicio del recorrido:</label>
            <input type="datetime-local" name="inicio" id="inicio" required><br>
            <label for="fin">Selecciona la fecha y hora del fin del recorrido:</label>
            <input type="datetime-local" name="fin" id="fin" required><br><br>
            <input type="button" value="Submit" id="btnSubmit" onclick="testVariable()">
        </form>
    </div>
    
    <script>
        function testVariable() {
            var strText = document.getElementById("inicio").value;
            var strText1 = document.getElementById("fin").value;
            document.getElementById("long").innerHTML = strText;
            document.getElementById("lat").innerHTML = strText1;

            if ("inicio > fin ") {
                alert("Rango de fecha inv√°lido")
                update = setInterval(function () {
            document.getElementById("lat").innerHTML = "Error";
            document.getElementById("long").innerHTML = "Error";
            document.getElementById("timestamp").innerHTML = "Error";
              }, 1000);

            } 

        
        }
        function showForm() {
            document.getElementById('form_fecha').style.display = 'block';
        }
        function hideForm() {
            document.getElementById('form_fecha').style.display = 'none';
        
        function lockCoordinates() {
            clearInterval(update);
        }
        }
    </script>

    <div id="map">
    </div>

    <script >
        var pathCoordinates = Array();
        function initMap() {
            //var coord = {lat:10.949185 ,lng: -74.803391};
            var map = new google.maps.Map(document.getElementById('map'),{
            zoom: 12, center: {lat:10.949185 ,lng: -74.803391}
            });
        
            var marker = new google.maps.Marker({
                position: {lat:10.949185 ,lng: -74.803391},
                map: map
                });
        }
    </script>

    <script >
        function livevalues() { 
            var map = new google.maps.Map(document.getElementById('map'),{
            zoom: 12, center: {lat:10.949185 ,lng: -74.803391}
            });  
            var marker = new google.maps.Marker({
                position: {lat:10.949185 ,lng: -74.803391},
                draggable: true,
                animation: google.maps.Animation.DROP,
                map: map
                });
                marker.addListener("click", toggleBounce);


            update = setInterval(function () {
                document.getElementById("lat").innerHTML = latitud;
                document.getElementById("long").innerHTML = longitud;
                document.getElementById("timestamp").innerHTML = fecha;

                var numlat = parseFloat(latitud);
                var numlon = parseFloat(longitud);

                var options = {
                    center:{lat:numlat, lng:numlon}
                }
                

                pathCoordinates.push({
                    lat : numlat,
                    lng : numlon
                });

                map.setOptions(options);
                marker.setPosition({lat:numlat, lng:numlon});

                var lineSymbol = {
                    path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW
                };
                new google.maps.Polyline({
                    path : pathCoordinates,
                    geodesic : true,
                    strokeColor : '#FF0000',
                    strokeOpacity : 1,
                    strokeWeight : 2,
                    icons: [{
                        icon: lineSymbol,
                        offset: '0',
                        repeat: '40px'
                    }],
                    JointType: 1,
                    map : map
                });

            }, 200); //es lo minimo
        }
        function historiavalues() { 
            var map = new google.maps.Map(document.getElementById('map'),{
            zoom: 12, center: {lat:10.949185 ,lng: -74.803391}
            });  

            var marker = new google.maps.Marker({
                position: {lat:10.949185 ,lng: -74.803391},
                map: map
                });


            update2 = setInterval(function () {


                document.getElementById("lat").innerHTML = latitud;
                document.getElementById("long").innerHTML = longitud;
                document.getElementById("timestamp").innerHTML = fecha;

                var numlat = parseFloat(latitud);
                var numlon = parseFloat(longitud);

                var options = {
                    center:{lat:numlat, lng:numlon}
                }
                

                pathCoordinates.push({
                    lat : numlat,
                    lng : numlon
                });

                map.setOptions(options);
                marker.setPosition({lat:numlat, lng:numlon});

                var lineSymbol = {
                    path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW
                };
                new google.maps.Polyline({
                    path : pathCoordinates,
                    geodesic : true,
                    strokeColor : '#FF0000',
                    strokeOpacity : 1,
                    strokeWeight : 2,
                    icons: [{
                        icon: lineSymbol,
                        offset: '0',
                        repeat: '40px'
                    }],
                    JointType: 1,
                    map : map
                });

            }, 200); //es lo minimo


        }
        function toggleBounce() {
             if (marker.getAnimation() !== null) {
            marker.setAnimation(null);
             } else {
            marker.setAnimation(google.maps.Animation.BOUNCE);
            }
        }
        
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCDvC1ZNHmu5pZjZtYyV6VZmBLaLeWSyZU&callback=initMap"></script>
</body>
</html>